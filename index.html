<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é•·å³¶ã‚¹ãƒ‘ãƒ¼ãƒ©ãƒ³ãƒ‰ ã‚¢ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒ©ãƒªãƒ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Noto Sans JP', sans-serif; }
      .font-pop { font-family: 'Mochiy Pop One', sans-serif; }
      .custom-checkbox:checked {
        background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        border-color: #3b82f6;
        background-color: #3b82f6;
      }
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
  </head>
  <body class="bg-gradient-to-b from-blue-200 to-green-200 min-h-screen">

    <div id="group-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
      <div class="bg-white p-8 rounded-2xl shadow-xl text-center w-full max-w-md">
        <h2 class="text-2xl font-bold mb-6 font-pop">å‚åŠ ã™ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é¸ã‚“ã§ã­ï¼</h2>
        <div id="group-selection" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
          <!-- Group buttons will be inserted here by JS -->
        </div>
      </div>
    </div>

    <div id="app-container" class="container mx-auto p-4 max-w-md hidden">
      <header class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-6 sticky top-4 z-10">
        <h1 class="text-xl md:text-2xl font-bold text-center text-gray-800 font-pop">é•·å³¶ã‚¹ãƒ‘ãƒ¼ãƒ©ãƒ³ãƒ‰<br>ã‚¢ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒ©ãƒªãƒ¼</h1>
        <div class="mt-4 text-center">
          <p id="group-name-display" class="text-lg text-blue-600 font-bold">ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—åï¼‰</p>
          <p class="text-4xl md:text-6xl font-bold text-blue-600 font-pop transition-all duration-300" id="total-points">0</p>
        </div>
      </header>
      <section class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-6">
        <h2 class="text-xl font-bold text-center text-gray-800 mb-4 font-pop">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
        <div id="scoreboard" class="space-y-3"></div>
      </section>
      <main id="attraction-list" class="space-y-4"></main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
      // â–¼â–¼â–¼â–¼â–¼ Firebaseã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æƒ…å ± â–¼â–¼â–¼â–¼â–¼
      // â€»ã€Œfirebase-setup.mdã€ã®æ‰‹é †ã«å¾“ã£ã¦ã€è‡ªåˆ†ã®æƒ…å ±ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
      const firebaseConfig = {
        apiKey: "AIzaSyC5qCuL_OUzH_TyEtg-aW9AkI-I_mBUPKo",
        authDomain: "nagasap-f23c5.firebaseapp.com",
        projectId: "nagasap-f23c5",
        storageBucket: "nagasap-f23c5.firebasestorage.app",
        messagingSenderId: "582187448865",
        appId: "web:4835e9e99428f50f38c160"
      };
      // â–²â–²â–²â–²â–² Firebaseã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æƒ…å ± â–²â–²â–²â–²â–²

      // --- ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ---
      let currentGroupId = null;
      let totalPoints = 0;
      const groupNames = ["A", "B", "C", "D", "E"];
      const attractions = [
        { name: 'ã‚¹ãƒãƒ¼ãƒ«ãƒ‰ãƒ©ã‚´ãƒ³2000', points: 250, category: 'SSSãƒ©ãƒ³ã‚¯', color: 'red', memo: 'ã¾ã•ã«ã‚­ãƒ³ã‚°ãƒ»ã‚ªãƒ–ãƒ»ã‚³ãƒ¼ã‚¹ã‚¿ãƒ¼ï¼å¾…ã¡æ™‚é–“ã‚‚æœ€é•·ã‚¯ãƒ©ã‚¹ã€‚ã“ã‚Œã‚’åˆ¶è¦‡ã§ãã‚Œã°å‹åˆ©ã¯ç›®å‰ï¼' },
        { name: 'ç™½é¯¨ï¼ˆHAKUGEIï¼‰', points: 230, category: 'SSSãƒ©ãƒ³ã‚¯', color: 'red', memo: 'ç†±ç‹‚çš„ãƒ•ã‚¡ãƒ³ãŒå¤šã„ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚³ãƒ¼ã‚¹ã‚¿ãƒ¼ã€‚æ¿€ã—ã„æºã‚Œã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã§é«˜ãƒã‚¤ãƒ³ãƒˆã‚’ã‚²ãƒƒãƒˆï¼' },
        { name: 'ã‚¢ã‚¯ãƒ­ãƒãƒƒãƒˆ', points: 180, category: 'SSãƒ©ãƒ³ã‚¯', color: 'red', memo: 'ã†ã¤ä¼ã›ã§é§†ã‘æŠœã‘ã‚‹çˆ½å¿«æ„ŸãŒäººæ°—ï¼å¾…ã¡æ™‚é–“ã‚‚é•·ã‚ãªã®ã§ã€è¨ˆç”»çš„ã«ç‹™ã„ãŸã„ã€‚' },
        { name: 'åµï¼ˆARASHIï¼‰', points: 170, category: 'SSãƒ©ãƒ³ã‚¯', color: 'red', memo: 'äºˆæ¸¬ä¸èƒ½ãªå›è»¢ãŒé­…åŠ›ï¼ã‚³ã‚¢ãªãƒ•ã‚¡ãƒ³ãŒå¤šãã€è¦‹ãŸç›®ä»¥ä¸Šã«æ‰‹å¼·ã„ã‚¢ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã€‚' },
        { name: 'ã‚¸ãƒ£ã‚¤ã‚¢ãƒ³ãƒˆãƒ•ãƒªã‚¹ãƒ“ãƒ¼', points: 120, category: 'Sãƒ©ãƒ³ã‚¯', color: 'red', memo: 'æ—¥æœ¬æœ€å¤§ç´šã®æŒ¯ã‚Šå­å‹çµ¶å«ãƒã‚·ãƒ³ã€‚å›è»¢ã¨é«˜ã•ã§ãƒã‚¤ãƒ³ãƒˆã‚‚é«˜ã‚ï¼' },
        { name: 'ã‚¹ãƒšãƒ¼ã‚¹ã‚·ãƒ§ãƒƒãƒˆ', points: 100, category: 'Sãƒ©ãƒ³ã‚¯', color: 'red', memo: 'ä¸€ç¬ã§åœ°ä¸Š75mã¸ï¼æ‹˜æŸæ™‚é–“ãŒçŸ­ãã€å›è»¢ç‡ãŒè‰¯ã„ã®ã§ã€æ™‚é–“ãŒãªã„æ™‚ã«ã‚ªã‚¹ã‚¹ãƒ¡ã€‚' },
        { name: 'ã‚·ãƒ£ãƒˆãƒ«ãƒ«ãƒ¼ãƒ—', points: 90, category: 'Sãƒ©ãƒ³ã‚¯', color: 'red', memo: 'ç™ºé€²ã‹ã‚‰ã‚ãšã‹2ç§’ã§ãƒˆãƒƒãƒ—ã‚¹ãƒ”ãƒ¼ãƒ‰ã«ï¼å¾€å¾©ã‚¿ã‚¤ãƒ—ã®å…ƒç¥–çµ¶å«ãƒã‚·ãƒ³ã€‚' },
        { name: 'ã‚³ãƒ¼ã‚¯ã‚¹ã‚¯ãƒªãƒ¥ãƒ¼', points: 80, category: 'Sãƒ©ãƒ³ã‚¯', color: 'red', memo: 'é€£ç¶š2å›è»¢ãŒç‰¹å¾´ã€‚ã‚¹ãƒªãƒ«ã¨ä¹—ã‚Šã‚„ã™ã•ã®ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ã„ã€‚' },
        { name: 'ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã‚¹ã‚¿ãƒ¼', points: 70, category: 'Aãƒ©ãƒ³ã‚¯', color: 'yellow', memo: 'ç¾ã—ã„å½¢ã®ãƒ«ãƒ¼ãƒ—ã‚³ãƒ¼ã‚¹ã‚¿ãƒ¼ã€‚çµ¶å«ç³»ã®ä¸­ã§ã¯æ¯”è¼ƒçš„å¾…ã¡æ™‚é–“ãŒçŸ­ã„å‚¾å‘ã€‚' },
        { name: 'ãƒ•ãƒ©ã‚¤ãƒ³ã‚°ã‚«ãƒ¼ãƒšãƒƒãƒˆ', points: 60, category: 'Aãƒ©ãƒ³ã‚¯', color: 'yellow', memo: 'é­”æ³•ã®çµ¨æ¯¯ã§ç©ºä¸­æ•£æ­©ã€‚æµ®éŠæ„ŸãŒæ°—æŒã¡ã„ã„ã€‚' },
        { name: 'ãƒã‚¤ã‚­ãƒ³ã‚°', points: 50, category: 'Aãƒ©ãƒ³ã‚¯', color: 'yellow', memo: 'å¤§ããªæµ·è³Šèˆ¹ãŒå·¦å³ã«ã‚¹ã‚¤ãƒ³ã‚°ï¼èˆ¹ã®ç«¯ã£ã“ãŒä¸€ç•ªã‚¹ãƒªãƒ«ãŒã‚ã‚‹ã€‚' },
        { name: 'ãƒ€ãƒ–ãƒ«ãƒ¯ã‚¤ãƒ«ãƒ‰ãƒã‚¦ã‚¹', points: 40, category: 'Aãƒ©ãƒ³ã‚¯', color: 'yellow', memo: 'æ€¥ã‚«ãƒ¼ãƒ–ã¨æ€¥åŠ é€ŸãŒæ¥½ã—ã„ï¼è¦‹ãŸç›®ã‚ˆã‚Šã‚¹ãƒªãƒ«ãŒã‚ã‚‹ã‹ã‚‚ã€‚' },
        { name: 'ã‚¦ã‚§ãƒ¼ãƒ–ã‚¹ã‚¦ã‚£ãƒ³ã‚¬ãƒ¼', points: 30, category: 'Bãƒ©ãƒ³ã‚¯', color: 'blue', memo: 'ç©ºé£›ã¶ãƒ–ãƒ©ãƒ³ã‚³ã€‚å›è»¢ã—ãªãŒã‚‰æ™¯è‰²ã‚’æ¥½ã—ã‚ã‚‹ã€‚' },
        { name: 'ãƒ†ãƒ¬ã‚³ãƒ³ãƒãƒƒãƒˆ', points: 25, category: 'Bãƒ©ãƒ³ã‚¯', color: 'blue', memo: 'è‡ªåˆ†ã§æ“ç¸¦ã—ã¦ä¸Šä¸‹ã«å‹•ã‹ã›ã‚‹æˆ¦é—˜æ©Ÿã€‚' },
        { name: 'å¤§è¦³è¦§è»Šã‚ªãƒ¼ãƒ­ãƒ©', points: 20, category: 'Cãƒ©ãƒ³ã‚¯', color: 'green', memo: 'é•·å³¶ã‚¹ãƒ‘ãƒ¼ãƒ©ãƒ³ãƒ‰ã®ã‚·ãƒ³ãƒœãƒ«ã€‚æ™¯è‰²ã‚’æ¥½ã—ã¿ãªãŒã‚‰ä¸€ä¼‘ã¿ã€‚' },
        { name: 'ãƒ¡ãƒªãƒ¼ã‚´ãƒ¼ãƒ©ãƒ³ãƒ‰', points: 15, category: 'Cãƒ©ãƒ³ã‚¯', color: 'green', memo: 'é¦¬ã‚„é¦¬è»Šã«ä¹—ã£ã¦å¤¢ã®ä¸–ç•Œã¸ã€‚å®šç•ªã®ç™’ã—ç³»ã‚¢ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã€‚' },
        { name: 'ãƒ†ã‚£ãƒ¼ã‚«ãƒƒãƒ—', points: 15, category: 'Cãƒ©ãƒ³ã‚¯', color: 'green', memo: 'å›ã—ã™ãæ³¨æ„ï¼ãƒ•ã‚¡ãƒŸãƒªãƒ¼ã‚„ã‚«ãƒƒãƒ—ãƒ«ã«äººæ°—ã€‚' },
        { name: 'ãƒ”ãƒ¼ã‚¿ãƒ¼ãƒ©ãƒ“ãƒƒãƒˆã‚³ãƒ¼ã‚¹ã‚¿ãƒ¼', points: 10, category: 'Dãƒ©ãƒ³ã‚¯', color: 'purple', memo: 'ã‚­ãƒƒã‚ºå‘ã‘ã®å¯æ„›ã„ã‚¸ã‚§ãƒƒãƒˆã‚³ãƒ¼ã‚¹ã‚¿ãƒ¼ã€‚åˆã‚ã¦ã®ã‚³ãƒ¼ã‚¹ã‚¿ãƒ¼ã«ã´ã£ãŸã‚Šã€‚' },
        { name: 'ã¡ã³ã£ã“ã²ã‚ã°', points: 5, category: 'Dãƒ©ãƒ³ã‚¯', color: 'purple', memo: 'å°ã•ãªå­ä¾›ãŸã¡ãŒå®‰å¿ƒã—ã¦éŠã¹ã‚‹ã‚¨ãƒªã‚¢ã€‚ä¹—ã‚Šç‰©ã‚‚ãŸãã•ã‚“ã€‚' }
      ];

      // --- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ã‚¤ãƒ³å‡¦ç† ---
      function main() {
        try {
          // Initialize Firebase
          firebase.initializeApp(firebaseConfig);
          const auth = firebase.auth();
          const db = firebase.firestore();

          // --- åˆæœŸåŒ–å‡¦ç† ---
          setupGroupSelection(db);
          setupAttractionList(db);
          
          auth.signInAnonymously().catch(error => console.error("Anonymous sign-in failed:", error));
        
        } catch (e) {
            console.error("Firebaseã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚firebaseConfigãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚", e);
            alert("ã‚¨ãƒ©ãƒ¼ï¼šFirebaseã®è¨­å®šãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚");
        }
      }

      // --- ã‚°ãƒ«ãƒ¼ãƒ—é¸æŠé–¢é€£ ---
      function setupGroupSelection(db) {
        const selectionDiv = document.getElementById('group-selection');
        groupNames.forEach((name, index) => {
          const button = document.createElement('button');
          button.className = "p-4 bg-blue-500 text-white font-bold rounded-lg text-xl hover:bg-blue-600 transition";
          button.textContent = `Group ${name}`;
          button.onclick = () => selectGroup(db, `group-${index + 1}`, `Group ${name}`);
          selectionDiv.appendChild(button);
        });
      }

      function selectGroup(db, groupId, groupName) {
        currentGroupId = groupId;
        document.getElementById('group-name-display').textContent = `${groupName} ã®ãƒã‚¤ãƒ³ãƒˆ`;
        document.getElementById('group-modal').classList.add('hidden');
        document.getElementById('app-container').classList.remove('hidden');
        listenToScores(db);
      }

      // --- Firestore & ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–° ---
      function listenToScores(db) {
        db.collection("groups").onSnapshot(snapshot => {
          let groups = [];
          snapshot.forEach(doc => groups.push({ id: doc.id, ...doc.data() }));
          
          groupNames.forEach((name, index) => {
              const groupId = `group-${index + 1}`;
              if (!groups.some(g => g.id === groupId)) {
                  const groupData = { name: `Group ${name}`, score: 0 };
                  db.collection("groups").doc(groupId).set(groupData).catch(e => console.error("Group creation failed: ", e));
                  groups.push({ id: groupId, ...groupData});
              }
          });
          updateScoreboardUI(groups);
          
          const myGroup = groups.find(g => g.id === currentGroupId);
          if(myGroup) {
            totalPoints = myGroup.score;
            document.getElementById('total-points').textContent = totalPoints;
          }
        });
      }
      
      function updateScoreboardUI(groups) {
        const scoreboardDiv = document.getElementById('scoreboard');
        scoreboardDiv.innerHTML = '';
        groups.sort((a, b) => b.score - a.score);
        groups.forEach((group, index) => {
            const isMyGroup = group.id === currentGroupId;
            const rank = index + 1;
            let medal = '';
            if (rank === 1) medal = 'ğŸ¥‡';
            if (rank === 2) medal = 'ğŸ¥ˆ';
            if (rank === 3) medal = 'ğŸ¥‰';
            const item = `
            <div class="flex items-center p-3 rounded-lg ${isMyGroup ? 'bg-blue-100 ring-2 ring-blue-400' : 'bg-gray-50'}">
              <div class="text-xl font-bold w-10">${medal || rank}</div>
              <div class="flex-grow font-semibold text-gray-700">${group.name}</div>
              <div class="text-xl font-bold text-blue-500">${group.score} pt</div>
            </div>`;
            scoreboardDiv.innerHTML += item;
        });
      }

      // --- ã‚¢ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒªã‚¹ãƒˆ & ãƒã‚¤ãƒ³ãƒˆè¨ˆç®— ---
      function setupAttractionList(db) {
        const listElement = document.getElementById('attraction-list');
        listElement.innerHTML = '';
        attractions.forEach((attr, index) => {
          const card = `
            <div id="card-${index}" class="bg-white p-4 rounded-xl shadow-md transition-all duration-300 transform hover:scale-105">
              <div class="flex items-start">
                <div class="flex-grow">
                  <span class="inline-block bg-${attr.color}-200 text-${attr.color}-800 text-xs px-2 py-1 rounded-full font-semibold">${attr.category}</span>
                  <h2 class="text-lg font-bold mt-1 text-gray-800">${attr.name}</h2>
                  <p class="text-sm text-gray-500 mt-1">${attr.points} ãƒã‚¤ãƒ³ãƒˆ</p>
                  <p class="text-xs text-gray-600 mt-2 border-l-2 border-gray-200 pl-2">${attr.memo}</p>
                </div>
                <div class="flex-shrink-0 ml-4 pt-5">
                   <input type="checkbox" id="checkbox-${index}" data-points="${attr.points}" onchange="updateTotalPoints(this, db)"
                     class="custom-checkbox appearance-none w-8 h-8 rounded-lg border-2 border-gray-300 bg-white checked:bg-blue-500 checked:border-blue-500 focus:outline-none transition duration-200 cursor-pointer">
                </div>
              </div>
            </div>`;
          listElement.innerHTML += card;
        });
      }

      function updateTotalPoints(checkbox, db) {
        const points = parseInt(checkbox.dataset.points, 10);
        let newTotalPoints = checkbox.checked ? totalPoints + points : totalPoints - points;
        if (currentGroupId) {
            db.collection("groups").doc(currentGroupId).update({ score: newTotalPoints })
              .catch((error) => console.error("Error updating score: ", error));
        }
      }

      // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰mainé–¢æ•°ã‚’å®Ÿè¡Œ
      document.addEventListener('DOMContentLoaded', main);
    </script>
  </body>
</html>

