<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Èï∑Â≥∂„Çπ„Éë„Éº„É©„É≥„Éâ „Ç¢„Éà„É©„ÇØ„Ç∑„Éß„É≥„É©„É™„Éº</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Noto Sans JP', sans-serif; }
      .font-pop { font-family: 'Mochiy Pop One', sans-serif; }
      .custom-checkbox:checked {
        background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        border-color: #3b82f6;
        background-color: #3b82f6;
      }
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      .status-item { display: flex; align-items: center; }
      .status-icon { width: 24px; height: 24px; margin-right: 8px; }
    </style>
  </head>
  <body class="bg-gradient-to-b from-blue-200 to-green-200 min-h-screen">

    <div id="group-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
      <div class="bg-white p-8 rounded-2xl shadow-xl text-center w-full max-w-md">
        <h2 class="text-2xl font-bold mb-6 font-pop">ÂèÇÂä†„Åô„Çã„Ç∞„É´„Éº„Éó„ÇíÈÅ∏„Çì„Åß„Å≠ÔºÅ</h2>
        <div id="group-selection" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
          <!-- Group buttons will be inserted here by JS -->
        </div>
        <div id="status-panel" class="mt-6 p-4 bg-gray-100 rounded-lg text-left text-sm">
            <h3 class="font-bold text-gray-700 mb-2">Êé•Á∂ö„Çπ„ÉÜ„Éº„Çø„ÇπÔºàË®∫Êñ≠„É¢„Éº„ÉâÔºâ</h3>
            <div id="status-list" class="space-y-1"></div>
        </div>
      </div>
    </div>

    <div id="app-container" class="container mx-auto p-4 max-w-md hidden">
      <header class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-6 sticky top-4 z-10">
        <h1 class="text-xl md:text-2xl font-bold text-center text-gray-800 font-pop">Èï∑Â≥∂„Çπ„Éë„Éº„É©„É≥„Éâ<br>„Ç¢„Éà„É©„ÇØ„Ç∑„Éß„É≥„É©„É™„Éº</h1>
        <div class="mt-4 text-center">
          <p id="group-name-display" class="text-lg text-blue-600 font-bold">Ôºà„Ç∞„É´„Éº„ÉóÂêçÔºâ</p>
          <p class="text-4xl md:text-6xl font-bold text-blue-600 font-pop transition-all duration-300" id="total-points">0</p>
        </div>
      </header>
      <section class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-6">
        <h2 class="text-xl font-bold text-center text-gray-800 mb-4 font-pop">„É™„Ç¢„É´„Çø„Ç§„É†„É©„É≥„Ç≠„É≥„Ç∞</h2>
        <div id="scoreboard" class="space-y-3"></div>
      </section>
      <main id="attraction-list" class="space-y-4"></main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
      // ‚ñº‚ñº‚ñº‚ñº‚ñº Firebase„ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÊÉÖÂ†± ‚ñº‚ñº‚ñº‚ñº‚ñº
      // „ÄêÊúÄÈáçË¶Å„Äë„Åì„ÅÆ‰∏ã„ÅÆ const firebaseConfig = { ... }; „ÅÆÈÉ®ÂàÜÂÖ®‰Ωì„Çí„ÄÅ
      // „ÅÇ„Å™„ÅüËá™Ë∫´„ÅÆFirebase„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Åã„Çâ„Ç≥„Éî„Éº„Åó„Åü„Ç≥„Éº„Éâ„ÅßÂÆåÂÖ®„Å´ÁΩÆ„ÅçÊèõ„Åà„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
      const firebaseConfig = {
        apiKey: "AIzaSyC5qCuL_OUzH_TyEtg-aW9AkI-I_mBUPKo",
        authDomain: "nagasap-f23c5.firebaseapp.com",
        projectId: "nagasap-f23c5",
        storageBucket: "nagasap-f23c5.firebasestorage.app",
        messagingSenderId: "582187448865",
        appId: "1:582187448865:web:4835e9e99428f50f38c160"
      };
      // ‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤ Firebase„ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÊÉÖÂ†± ‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤


      // --- „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞ ---
      let currentGroupId = null;
      const groupNames = ["A", "B", "C", "D", "E"];
      const attractions = [
        { name: '„Çπ„ÉÅ„Éº„É´„Éâ„É©„Ç¥„É≥2000', points: 250, category: 'SSS„É©„É≥„ÇØ', color: 'red', memo: '„Åæ„Åï„Å´„Ç≠„É≥„Ç∞„Éª„Ç™„Éñ„Éª„Ç≥„Éº„Çπ„Çø„ÉºÔºÅÂæÖ„Å°ÊôÇÈñì„ÇÇÊúÄÈï∑„ÇØ„É©„Çπ„ÄÇ„Åì„Çå„ÇíÂà∂Ë¶á„Åß„Åç„Çå„Å∞ÂãùÂà©„ÅØÁõÆÂâçÔºÅ' },
        { name: 'ÁôΩÈØ®ÔºàHAKUGEIÔºâ', points: 230, category: 'SSS„É©„É≥„ÇØ', color: 'red', memo: 'ÁÜ±ÁãÇÁöÑ„Éï„Ç°„É≥„ÅåÂ§ö„ÅÑ„Éè„Ç§„Éñ„É™„ÉÉ„Éâ„Ç≥„Éº„Çπ„Çø„Éº„ÄÇÊøÄ„Åó„ÅÑÊè∫„Çå„Å®„Çπ„Éî„Éº„Éâ„ÅßÈ´ò„Éù„Ç§„É≥„Éà„Çí„Ç≤„ÉÉ„ÉàÔºÅ' },
        { name: '„Ç¢„ÇØ„É≠„Éê„ÉÉ„Éà', points: 180, category: 'SS„É©„É≥„ÇØ', color: 'red', memo: '„ÅÜ„Å§‰ºè„Åõ„ÅßÈßÜ„ÅëÊäú„Åë„ÇãÁàΩÂø´ÊÑü„Åå‰∫∫Ê∞óÔºÅÂæÖ„Å°ÊôÇÈñì„ÇÇÈï∑„ÇÅ„Å™„ÅÆ„Åß„ÄÅË®àÁîªÁöÑ„Å´Áãô„ÅÑ„Åü„ÅÑ„ÄÇ' },
        { name: 'ÂµêÔºàARASHIÔºâ', points: 170, category: 'SS„É©„É≥„ÇØ', color: 'red', memo: '‰∫àÊ∏¨‰∏çËÉΩ„Å™ÂõûËª¢„ÅåÈ≠ÖÂäõÔºÅ„Ç≥„Ç¢„Å™„Éï„Ç°„É≥„ÅåÂ§ö„Åè„ÄÅË¶ã„ÅüÁõÆ‰ª•‰∏ä„Å´ÊâãÂº∑„ÅÑ„Ç¢„Éà„É©„ÇØ„Ç∑„Éß„É≥„ÄÇ' },
        { name: '„Ç∏„É£„Ç§„Ç¢„É≥„Éà„Éï„É™„Çπ„Éì„Éº', points: 120, category: 'S„É©„É≥„ÇØ', color: 'red', memo: 'Êó•Êú¨ÊúÄÂ§ßÁ¥ö„ÅÆÊåØ„ÇäÂ≠êÂûãÁµ∂Âè´„Éû„Ç∑„É≥„ÄÇÂõûËª¢„Å®È´ò„Åï„Åß„Éù„Ç§„É≥„Éà„ÇÇÈ´ò„ÇÅÔºÅ' },
        { name: '„Çπ„Éö„Éº„Çπ„Ç∑„Éß„ÉÉ„Éà', points: 100, category: 'S„É©„É≥„ÇØ', color: 'red', memo: '‰∏ÄÁû¨„ÅßÂú∞‰∏ä75m„Å∏ÔºÅÊãòÊùüÊôÇÈñì„ÅåÁü≠„Åè„ÄÅÂõûËª¢Áéá„ÅåËâØ„ÅÑ„ÅÆ„Åß„ÄÅÊôÇÈñì„Åå„Å™„ÅÑÊôÇ„Å´„Ç™„Çπ„Çπ„É°„ÄÇ' },
        { name: '„Ç∑„É£„Éà„É´„É´„Éº„Éó', points: 90, category: 'S„É©„É≥„ÇØ', color: 'red', memo: 'Áô∫ÈÄ≤„Åã„Çâ„Çè„Åö„Åã2Áßí„Åß„Éà„ÉÉ„Éó„Çπ„Éî„Éº„Éâ„Å´ÔºÅÂæÄÂæ©„Çø„Ç§„Éó„ÅÆÂÖÉÁ•ñÁµ∂Âè´„Éû„Ç∑„É≥„ÄÇ' },
        { name: '„Ç≥„Éº„ÇØ„Çπ„ÇØ„É™„É•„Éº', points: 80, category: 'S„É©„É≥„ÇØ', color: 'red', memo: 'ÈÄ£Á∂ö2ÂõûËª¢„ÅåÁâπÂæ¥„ÄÇ„Çπ„É™„É´„Å®‰πó„Çä„ÇÑ„Åô„Åï„ÅÆ„Éê„É©„É≥„Çπ„ÅåËâØ„ÅÑ„ÄÇ' },
        { name: '„É´„Éº„Éî„É≥„Ç∞„Çπ„Çø„Éº', points: 70, category: 'A„É©„É≥„ÇØ', color: 'yellow', memo: 'Áæé„Åó„ÅÑÂΩ¢„ÅÆ„É´„Éº„Éó„Ç≥„Éº„Çπ„Çø„Éº„ÄÇÁµ∂Âè´Á≥ª„ÅÆ‰∏≠„Åß„ÅØÊØîËºÉÁöÑÂæÖ„Å°ÊôÇÈñì„ÅåÁü≠„ÅÑÂÇæÂêë„ÄÇ' },
        { name: '„Éï„É©„Ç§„É≥„Ç∞„Ç´„Éº„Éö„ÉÉ„Éà', points: 60, category: 'A„É©„É≥„ÇØ', color: 'yellow', memo: 'È≠îÊ≥ï„ÅÆÁµ®ÊØØ„ÅßÁ©∫‰∏≠Êï£Ê≠©„ÄÇÊµÆÈÅäÊÑü„ÅåÊ∞óÊåÅ„Å°„ÅÑ„ÅÑ„ÄÇ' },
        { name: '„Éê„Ç§„Ç≠„É≥„Ç∞', points: 50, category: 'A„É©„É≥„ÇØ', color: 'yellow', memo: 'Â§ß„Åç„Å™Êµ∑Ë≥äËàπ„ÅåÂ∑¶Âè≥„Å´„Çπ„Ç§„É≥„Ç∞ÔºÅËàπ„ÅÆÁ´Ø„Å£„Åì„Åå‰∏ÄÁï™„Çπ„É™„É´„Åå„ÅÇ„Çã„ÄÇ' },
        { name: '„ÉÄ„Éñ„É´„ÉØ„Ç§„É´„Éâ„Éû„Ç¶„Çπ', points: 40, category: 'A„É©„É≥„ÇØ', color: 'yellow', memo: 'ÊÄ•„Ç´„Éº„Éñ„Å®ÊÄ•Âä†ÈÄü„ÅåÊ•Ω„Åó„ÅÑÔºÅË¶ã„ÅüÁõÆ„Çà„Çä„Çπ„É™„É´„Åå„ÅÇ„Çã„Åã„ÇÇ„ÄÇ' },
        { name: '„Ç¶„Çß„Éº„Éñ„Çπ„Ç¶„Ç£„É≥„Ç¨„Éº', points: 30, category: 'B„É©„É≥„ÇØ', color: 'blue', memo: 'Á©∫È£õ„Å∂„Éñ„É©„É≥„Ç≥„ÄÇÂõûËª¢„Åó„Å™„Åå„ÇâÊôØËâ≤„ÇíÊ•Ω„Åó„ÇÅ„Çã„ÄÇ' },
        { name: '„ÉÜ„É¨„Ç≥„É≥„Éê„ÉÉ„Éà', points: 25, category: 'B„É©„É≥„ÇØ', color: 'blue', memo: 'Ëá™ÂàÜ„ÅßÊìçÁ∏¶„Åó„Å¶‰∏ä‰∏ã„Å´Âãï„Åã„Åõ„ÇãÊà¶ÈóòÊ©ü„ÄÇ' },
        { name: 'Â§ßË¶≥Ë¶ßËªä„Ç™„Éº„É≠„É©', points: 20, category: 'C„É©„É≥„ÇØ', color: 'green', memo: 'Èï∑Â≥∂„Çπ„Éë„Éº„É©„É≥„Éâ„ÅÆ„Ç∑„É≥„Éú„É´„ÄÇÊôØËâ≤„ÇíÊ•Ω„Åó„Åø„Å™„Åå„Çâ‰∏Ä‰ºë„Åø„ÄÇ' },
        { name: '„É°„É™„Éº„Ç¥„Éº„É©„É≥„Éâ', points: 15, category: 'C„É©„É≥„ÇØ', color: 'green', memo: 'È¶¨„ÇÑÈ¶¨Ëªä„Å´‰πó„Å£„Å¶Â§¢„ÅÆ‰∏ñÁïå„Å∏„ÄÇÂÆöÁï™„ÅÆÁôí„ÅóÁ≥ª„Ç¢„Éà„É©„ÇØ„Ç∑„Éß„É≥„ÄÇ' },
        { name: '„ÉÜ„Ç£„Éº„Ç´„ÉÉ„Éó', points: 15, category: 'C„É©„É≥„ÇØ', color: 'green', memo: 'Âõû„Åó„Åô„ÅéÊ≥®ÊÑèÔºÅ„Éï„Ç°„Éü„É™„Éº„ÇÑ„Ç´„ÉÉ„Éó„É´„Å´‰∫∫Ê∞ó„ÄÇ' },
        { name: '„Éî„Éº„Çø„Éº„É©„Éì„ÉÉ„Éà„Ç≥„Éº„Çπ„Çø„Éº', points: 10, category: 'D„É©„É≥„ÇØ', color: 'purple', memo: '„Ç≠„ÉÉ„Ç∫Âêë„Åë„ÅÆÂèØÊÑõ„ÅÑ„Ç∏„Çß„ÉÉ„Éà„Ç≥„Éº„Çπ„Çø„Éº„ÄÇÂàù„ÇÅ„Å¶„ÅÆ„Ç≥„Éº„Çπ„Çø„Éº„Å´„Å¥„Å£„Åü„Çä„ÄÇ' },
        { name: '„Å°„Å≥„Å£„Åì„Å≤„Çç„Å∞', points: 5, category: 'D„É©„É≥„ÇØ', color: 'purple', memo: 'Â∞è„Åï„Å™Â≠ê‰æõ„Åü„Å°„ÅåÂÆâÂøÉ„Åó„Å¶ÈÅä„Åπ„Çã„Ç®„É™„Ç¢„ÄÇ‰πó„ÇäÁâ©„ÇÇ„Åü„Åè„Åï„Çì„ÄÇ' }
      ];

      // --- Ë®∫Êñ≠„É¢„Éº„ÉâÁî®„Éò„É´„Éë„Éº ---
      const statusList = document.getElementById('status-list');
      const addStatus = (message, type = 'pending') => {
        const item = document.createElement('div');
        item.className = 'status-item';
        let icon = '';
        let colorClass = 'text-gray-600';
        if (type === 'success') {
          icon = '‚úÖ';
          colorClass = 'text-green-600';
        } else if (type === 'error') {
          icon = '‚ùå';
          colorClass = 'text-red-600 font-bold';
        } else {
          icon = '‚è≥';
        }
        item.innerHTML = `<span class="status-icon">${icon}</span> <span class="${colorClass}">${message}</span>`;
        statusList.appendChild(item);
      };

      // --- „É°„Ç§„É≥Âá¶ÁêÜ ---
      async function main() {
        try {
          addStatus('FirebaseË®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø');
          if (!firebaseConfig || !firebaseConfig.apiKey || firebaseConfig.apiKey.startsWith("YOUR_")) {
            throw new Error('Ë®≠ÂÆöÊÉÖÂ†±„ÅåÊõ¥Êñ∞„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ');
          }
          addStatus('FirebaseË®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø: ‚úÖ ÊàêÂäü', 'success');

          addStatus('Firebase„ÅÆÂàùÊúüÂåñ');
          const app = firebase.initializeApp(firebaseConfig);
          addStatus('Firebase„ÅÆÂàùÊúüÂåñ: ‚úÖ ÊàêÂäü', 'success');

          const auth = firebase.auth();
          const db = firebase.firestore();

          addStatus('ÂåøÂêçË™çË®º„Åß„Çµ„Ç§„É≥„Ç§„É≥');
          await auth.signInAnonymously();
          addStatus('ÂåøÂêçË™çË®º„Åß„Çµ„Ç§„É≥„Ç§„É≥: ‚úÖ ÊàêÂäü', 'success');

          addStatus('„Éá„Éº„Çø„Éô„Éº„ÇπÊé•Á∂ö„ÅÆ„ÉÜ„Çπ„Éà');
          await db.collection('_test').doc('_test').get();
          addStatus('„Éá„Éº„Çø„Éô„Éº„ÇπÊé•Á∂ö„ÅÆ„ÉÜ„Çπ„Éà: ‚úÖ ÊàêÂäü', 'success');

          addStatus('„Ç¢„Éó„É™„ÅÆÊ∫ñÂÇôÂÆå‰∫ÜÔºÅ„Ç∞„É´„Éº„Éó„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'success');

          setupGroupSelection(db);
          setupAttractionList(db);

        } catch (e) {
          console.error("Ëá¥ÂëΩÁöÑ„Å™„Ç®„É©„Éº:", e);
          addStatus(`„Ç®„É©„Éº: ${e.message}`, 'error');
          if (e.message && e.message.includes("auth/configuration-not-found")) {
              addStatus("„Éí„É≥„Éà: FirebaseË®≠ÂÆöÊÉÖÂ†±„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇFirebase„Ç≥„É≥„ÇΩ„Éº„É´„Åã„Çâ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Ç≥„Éî„Éº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ", "error");
          } else if (e.message && e.message.includes("Could not reach Firestore backend")) {
              addStatus("„Éí„É≥„Éà: „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÊé•Á∂ö„Åæ„Åü„ÅØFirebase„ÅÆ„Çª„Ç≠„É•„É™„ÉÜ„Ç£„É´„Éº„É´„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ", "error");
          }
        }
      }

      function setupGroupSelection(db) {
        const selectionDiv = document.getElementById('group-selection');
        selectionDiv.innerHTML = '';
        groupNames.forEach((name, index) => {
          const button = document.createElement('button');
          button.className = "p-4 bg-blue-500 text-white font-bold rounded-lg text-xl hover:bg-blue-600 transition";
          button.textContent = `Group ${name}`;
          button.onclick = () => selectGroup(db, `group-${index + 1}`, `Group ${name}`);
          selectionDiv.appendChild(button);
        });
      }

      function selectGroup(db, groupId, groupName) {
        currentGroupId = groupId;
        const groupDocRef = db.collection("groups").doc(groupId);
        
        groupDocRef.get().then(doc => {
          if (!doc.exists) {
            groupDocRef.set({
              name: groupName,
              score: 0,
              checkedAttractions: []
            }).then(() => showAppUIAndStartListening(db, groupName))
              .catch(e => console.error("„Ç∞„É´„Éº„Éó‰ΩúÊàê„Ç®„É©„Éº", e));
          } else {
            showAppUIAndStartListening(db, groupName);
          }
        }).catch(e => console.error("„Ç∞„É´„Éº„ÉóÂèñÂæó„Ç®„É©„Éº", e));
      }

      function showAppUIAndStartListening(db, groupName) {
        document.getElementById('group-name-display').textContent = `${groupName} „ÅÆ„Éù„Ç§„É≥„Éà`;
        document.getElementById('group-modal').classList.add('hidden');
        document.getElementById('app-container').classList.remove('hidden');
        listenToScores(db);
      }

      function listenToScores(db) {
        db.collection("groups").onSnapshot(snapshot => {
          let groups = [];
          snapshot.forEach(doc => {
            if (doc.exists) groups.push({ id: doc.id, ...doc.data() });
          });
          updateScoreboardUI(groups);
          const myGroup = groups.find(g => g.id === currentGroupId);
          if (myGroup) {
            document.getElementById('total-points').textContent = myGroup.score || 0;
            const checkedIds = myGroup.checkedAttractions || [];
            attractions.forEach((_, index) => {
              const checkbox = document.getElementById(`checkbox-${index}`);
              if (checkbox) checkbox.checked = checkedIds.includes(checkbox.id);
            });
          }
        }, e => console.error("„Éá„Éº„ÇøÁõ£Ë¶ñ„Ç®„É©„Éº", e));
      }
      
      function updateScoreboardUI(groups) {
        const scoreboardDiv = document.getElementById('scoreboard');
        scoreboardDiv.innerHTML = '';
        groups.sort((a, b) => (b.score || 0) - (a.score || 0));
        groups.forEach((group, index) => {
            const isMyGroup = group.id === currentGroupId;
            const rank = index + 1;
            let medal = (rank === 1) ? 'ü•á' : (rank === 2) ? 'ü•à' : (rank === 3) ? 'ü•â' : '';
            scoreboardDiv.innerHTML += `
            <div class="flex items-center p-3 rounded-lg ${isMyGroup ? 'bg-blue-100 ring-2 ring-blue-400' : 'bg-gray-50'}">
              <div class="text-xl font-bold w-10">${medal || rank}</div>
              <div class="flex-grow font-semibold text-gray-700">${group.name}</div>
              <div class="text-xl font-bold text-blue-500">${group.score || 0} pt</div>
            </div>`;
        });
      }

      function setupAttractionList(db) {
        const listElement = document.getElementById('attraction-list');
        listElement.innerHTML = '';
        attractions.forEach((attr, index) => {
          listElement.innerHTML += `
            <div id="card-${index}" class="bg-white p-4 rounded-xl shadow-md transition-all duration-300 transform hover:scale-105">
              <div class="flex items-start">
                <div class="flex-grow">
                  <span class="inline-block bg-${attr.color}-200 text-${attr.color}-800 text-xs px-2 py-1 rounded-full font-semibold">${attr.category}</span>
                  <h2 class="text-lg font-bold mt-1 text-gray-800">${attr.name}</h2>
                  <p class="text-sm text-gray-500 mt-1">${attr.points} „Éù„Ç§„É≥„Éà</p>
                  <p class="text-xs text-gray-600 mt-2 border-l-2 border-gray-200 pl-2">${attr.memo}</p>
                </div>
                <div class="flex-shrink-0 ml-4 pt-5">
                   <input type="checkbox" id="checkbox-${index}" data-points="${attr.points}" onchange="updateTotalPoints(this, db)"
                     class="custom-checkbox appearance-none w-8 h-8 rounded-lg border-2 border-gray-300 bg-white checked:bg-blue-500 checked:border-blue-500 focus:outline-none transition duration-200 cursor-pointer">
                </div>
              </div>
            </div>`;
        });
      }

      function updateTotalPoints(checkbox, db) {
          const points = parseInt(checkbox.dataset.points, 10);
          const checkboxId = checkbox.id;
          if (currentGroupId) {
              const groupDocRef = db.collection("groups").doc(currentGroupId);
              const updateData = {
                  score: firebase.firestore.FieldValue.increment(checkbox.checked ? points : -points),
                  checkedAttractions: checkbox.checked 
                      ? firebase.firestore.FieldValue.arrayUnion(checkboxId) 
                      : firebase.firestore.FieldValue.arrayRemove(checkboxId)
              };
              groupDocRef.update(updateData).catch(e => {
                  console.error("„Éù„Ç§„É≥„ÉàÊõ¥Êñ∞„Ç®„É©„Éº", e);
                  checkbox.checked = !checkbox.checked;
              });
          }
      }
      
      document.addEventListener('DOMContentLoaded', main);
    </script>
  </body>
</html>

